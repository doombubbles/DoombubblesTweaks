new entry "MagicalAmbush"
type "PassiveData"
using "MagicalAmbush"
data "ExtraDescription" "h5320a8bcg54bdg4237gb4d9g0d823cf23541"

new entry "Interrupt_SneakAttack"
type "InterruptData"
using "Interrupt_SneakAttack"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and (((WieldingFinesseWeaponInSpecificHand(context.Observer,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsMainHandAttack()) or ((WieldingFinesseWeaponInSpecificHand(context.Observer,true) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or (IsSpellAttack() and HasPassive('MagicalAmbush', context.Source))) and not IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"
data "Properties" "IF(IsMeleeAttack() and not IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(LevelMapValue(SkullduggeryAttack), Force);IF(IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), Force, Magical)"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and ((WieldingFinesseWeaponInSpecificHand(context.Source,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Source)) or (WieldingFinesseWeaponInSpecificHand(context.Source,true) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Source)) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw)) and (not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise'))"

new entry "Interrupt_SneakAttack_Critical"
type "InterruptData"
using "Interrupt_SneakAttack_Critical"
data "Conditions" "Self(context.Source,context.Observer) and (((WieldingFinesseWeaponInSpecificHand(context.Observer,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsMainHandAttack()) or ((WieldingFinesseWeaponInSpecificHand(context.Observer,true) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or (IsSpellAttack() and HasPassive('MagicalAmbush', context.Source))) and HasDamageEffectFlag(DamageFlags.Hit) and IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"

new entry "Target_SneakAttack"
type "SpellData"
data "SpellType" "Target"
using "Target_SneakAttack"
data "RequirementConditions" "(WieldingFinesseWeaponInSpecificHand(context.Source,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Source)) and HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source)"

new entry "MAG_ForcefulSneakAttack_Passive"
type "PassiveData"
using "MAG_ForcefulSneakAttack_Passive"
data "Description" "h58254325ga049g45f4g910cg2f090494ec7b"
data "DescriptionParams" "DealDamage(1d6, Force);DealDamage(3d6, Force)"
data "Conditions" "SpellId('Target_SneakAttack') or SpellId('Projectile_SneakAttack') or SpellId('Interrupt_SneakAttack') or SpellId('Target_SneakAttack_Rakish') or SpellId('Projectile_SneakAttack_Rakish') or SpellId('Interrupt_SneakAttack_Rakish')"
data "StatsFunctors" "DealDamage(LevelMapValue(SkullduggeryAttack), Force,Magical)"

new entry "ReliableTalent"
type "PassiveData"
using "ReliableTalent"
data "ExtraDescription" "hb6374ae0gb096g4db1g876ag7ef2b68957d1"
data "ExtraDescriptionParams" "3"
data "Boosts" "IF(HasProficiencyBonus(context.CheckedAbility,context.CheckedSkill,context.Source)):MinimumRollResult(RawAbility,10);IF(HasProficiencyBonus(context.CheckedAbility,context.CheckedSkill,context.Source)):MinimumRollResult(SkillCheck,10);IF(HasProficiencyBonus(context.CheckedAbility,context.CheckedSkill,context.Source)):MinimumRollResult(SavingThrow,10);MinimumRollResult(Damage,3)"

new entry "Interrupt_SneakAttack_Rakish"
type "InterruptData"
using "Interrupt_SneakAttack_Rakish"
data "Conditions" "Self(context.Source,context.Observer) and not Self() and HasDamageEffectFlag(DamageFlags.Hit) and (((WieldingFinesseWeaponInSpecificHand(context.Observer,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsMainHandWeaponAttack()) or ((WieldingFinesseWeaponInSpecificHand(context.Observer,true) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack())) and not IsCritical() and not IsKillingBlow() and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and ((HasAdvantage(AttackType.MeleeWeaponAttack) or HasAllyWithinRange('SG_Incapacitated',1.5)) or (not HasEnemyWithinRange('SG_Incapacitated',1.5, nil, 2,context.Source,context.Target) and not HasAllyWithinRange('SG_Incapacitated',1.5, nil,false,context.Source,context.Target))) and not AnyEntityIsItem();"
data "Properties" "IF(IsMeleeAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType,,,0,,true,true);IF(IsRangedAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType,,,0,,true,true);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(LevelMapValue(SkullduggeryAttack), Force,Magical,,0,,true,true);"

new entry "Interrupt_SneakAttack_Rakish_Critical"
type "InterruptData"
using "Interrupt_SneakAttack_Rakish_Critical"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and (((WieldingFinesseWeaponInSpecificHand(context.Observer,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsMainHandWeaponAttack()) or ((WieldingFinesseWeaponInSpecificHand(context.Observer,true) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Observer)) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack())) and IsCritical() and not IsKillingBlow() and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and ((HasAdvantage(AttackType.MeleeWeaponAttack) or HasAllyWithinRange('SG_Incapacitated',1.5)) or (not HasEnemyWithinRange('SG_Incapacitated',1.5, nil, 2,context.Source,context.Target) and not HasAllyWithinRange('SG_Incapacitated',1.5, nil,false,context.Source,context.Target))) and not AnyEntityIsItem();"
data "Properties" "IF(IsMeleeAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType,,,0,,true,true);IF(IsRangedAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType,,,0,,true,true);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(LevelMapValue(SkullduggeryAttack), Force,Magical,,0,,true,true);"


new entry "Target_DirtyTrick_Disarm"
type "SpellData"
data "SpellType" "Target"
using "Target_DirtyTrick_Disarm"
data "SpellSuccess" "IF(HasWeaponInMainHand() and not SavingThrow(Ability.Dexterity, SourceSpellDC())):ApplyStatus(DISARM,100,1);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType);ApplyStatus(SELF,SWASHBUCKLER_ADV,100,2);"
data "TargetConditions" "Character() and not Self() and not Dead()"
data "RequirementConditions" "WieldingFinesseWeaponInSpecificHand(context.Source,false) or HasPassive('LOW_Guildhall_AdaptableSneakAttacks', context.Source)"