new entry "MagicalAmbush"
type "PassiveData"
using "MagicalAmbush"
data "ExtraDescription" "h5320a8bcg54bdg4237gb4d9g0d823cf23541"

new entry "Interrupt_SneakAttack"
type "InterruptData"
using "Interrupt_SneakAttack"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or (IsSpellAttack() and HasPassive('MagicalAmbush', context.Source))) and not IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"
data "Properties" "IF(IsMeleeAttack() and not IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4, Force);IF(IsSpellAttack()):DealDamage(LevelMapValue(SneakAttack), Force, Magical)"

new entry "Interrupt_SneakAttack_Critical"
type "InterruptData"
using "Interrupt_SneakAttack_Critical"
data "Conditions" "Self(context.Source,context.Observer) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or (IsSpellAttack() and HasPassive('MagicalAmbush', context.Source))) and HasDamageEffectFlag(DamageFlags.Hit) and IsCritical() and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack')) and not AnyEntityIsItem()"



new entry "Target_SneakAttack"
type "SpellData"
data "SpellType" "Target"
using "Target_SneakAttack"
data "Cooldown" ""

new entry "Projectile_SneakAttack"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_SneakAttack"
data "Cooldown" ""

new entry "ImprovedSneakAttack"
type "PassiveData"
data "DisplayName" "h9f776c11ga9c3g45f7g88d0gc0ace82139e2"
data "Description" "hc9bbcbddg1c42g4399ga4cegf63870aa9688"
data "Icon" "Action_SneakAttack_Melee"
data "Properties" "Highlighted"
data "Boosts" "ActionResource(SneakAttack_Charge,1,0)"